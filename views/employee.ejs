<% layout('applayout') %>
<body>
<div class="container-fluid ">  
  <div class="row">
    <div class="col-sm-2" id="sidebar" >
      <nav class="nav flex-column navbar-expand-lg nav-fill " >
        <a class="nav-link active text-light navbar-brand" href="#"><h4>theLittleShop</h3></a>
        <a class="nav-link text-light" href="#">Home</a>
        <a class="nav-link text-light" href="#">Inventory</a>
        <a class="nav-link text-light" href="#">Transaction</a>
      </nav>
    </div>
    <div class="col-sm-7 ">
      <h3>Current Sales</h3>
      <div class="table-responsive"style="height: 512px;overflow:auto;> <!-- style="height: 400px ;overflow:auto; -->
      <table class="table table-primary" id="salesTable">
        <thead id="table-head">
          <tr>
            <th scope="col">#<%=item[0].productName%></th>
            <th scope="col" id="barcode">Item ID</th>
            <th scope="col">Item Name</th>
            <th scope="col">Quantity</th>
            <th scope="col">Item Price</th>
          </tr>
        </thead>
      </table>
      
    </div>
  </div>
  <div class="col-sm-3">
    <div id="avatar">
      <!-- <img src="images/user.svg"  width="40" height="40" alt="Employee Avatar"> -->
      <p> Employee Name</p>
      <!-- <a class="btn btn-primary" href="#" role="button">Log out</a> -->
      <table class="table" id="rightTable">
        <tr>
          <th scope="col">SubTotal</th>
          <td scope="col" id="sub_total">0</td>
        </tr>
        <tr>
          <th scope="col">Promotion</th>
          <td scope="col" id="promotion">0</td>
        </tr>
        <tr>
          <th scope="col">Tax</th>
          <td scope="col" id="tax">0</td>
        </tr>
        <tr>
          <th scope="col">Item ID</th>
          <td scope="col">
            <input type="text" id="item_id">
          </td>
        </tr>
        <tr>
          <th scope="col">Quantity</th>
          <td scope="col">  <input type="number" name="quantity" min="1" value=1 id="quantity"></td>
        </tr>
        <tr>
          <th scope="col">Total</th>
          <td scope="col" id="sum">0</td>
        </tr>
      </table>
      <table >
        <tbody>
          <tr>
            <th>
              <button type="button" class="btn" id="add_btn" onclick="addFunc()">Add Item</button>
            </th>
            <th>
              <button type="button" class="btn promBtn" onclick="promFunc(10)">10%</button>
            </th>
          </tr>
          <tr>
            <th>
              <button type="button" class="btn" id="scan_btn">Scan Barcode</button>
            </th>
            <th>
              <button type="button" class="btn promBtn" onclick="promFunc(20)">20%</button>
            </th>
          </tr>
          <tr>
            <th>
              <button type="button" class="btn" id="voucher_btn"  data-toggle="modal" data-target="#voucherModal">Add Voucher</button>
            </th>
            <th>
              <button type="button" class="btn promBtn" onclick="promFunc(50)">50%</button>
            </th>
          </tr>
          <tr>
            <td colspan="2" rowspan="2">
              <button type="button" class="btn" id="pay_btn" onclick="payFunc()">Pay</button>
            </td>
          </tr>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>
<!-- end container -->
</div>
<!-- Modal for Pay button-->
<div id="myModal" class="modal fade" role="dialog">
<div class="modal-dialog">
<!-- Modal content-->
<div class="modal-content">
  <!-- <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title">Modal Header</h4>
  </div> -->
  <div class="modal-body">
    <p id="my_modal_value"></p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
  </div>
</div>
</div>
</div>
<!-- Modal for Add Voucher button-->
<div id="voucherModal" class="modal fade" role="dialog">
<div class="modal-dialog">
<!-- Modal content-->
<div class="modal-content">
  <!-- <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title">Modal Header</h4>
  </div> -->
  <div class="modal-body">
    <div class="input-group mb-3">
      <div class="input-group-prepend">
      </div>
      <input type="text" class="form-control" placeholder="Discount Percentage" aria-label="" aria-describedby="basic-addon1" id="voucherInput" style="width: 80px">
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" id="voucherCloseBtn" class="btn btn-default" data-dismiss="modal" onclick="voucherFunct()">Close</button>
  </div>
</div>
</div>
</div>
<!-- Modal for Camera-->
<div id="camModal" class="modal fade" role="dialog">
<div class="modal-dialog">
<!-- Modal content-->
<div class="modal-content">
  <div class="modal-body">
    <div id="scanner-container"></div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal" >Close</button>
  </div>
</div>
</div>
</div>

<script>
    function addFunc() {
	if (document.getElementById("item_id").value == null) {
		alert("Please enter item id");
	}
	var table = document.getElementById("salesTable");
	var row = table.insertRow(-1);
	var cell1 = row.insertCell(0);
	var cell2 = row.insertCell(1);
	var cell3 = row.insertCell(2);
	var cell4 = row.insertCell(3);
	var cell5 = row.insertCell(4);	
	
	if (document.getElementById("quantity").value == null) 
		document.getElementById("quantity").value = 5;	
	do {
		var quantity = document.getElementById("quantity").value;	
	} while (quantity == null);
  var initData = JSON.parse('<%-JSON.stringify(item)%>');
  var datagood = $.grep(initData, function (item) {
    return item.productID == document.getElementById("item_id").value;
});
  
	cell1.innerHTML = "a";
	cell2.innerHTML = document.getElementById("item_id").value;
	cell3.innerHTML = datagood[0].productName;
	cell4.innerHTML = document.getElementById("quantity").value;
	cell5.innerHTML = datagood[0].price;
	sub_total = sub_total +  price*quantity;
	document.getElementById("sub_total").innerHTML = sub_total;
	document.getElementById("tax").innerHTML = sub_total*(100-promotion)/100 * 0.1;
	document.getElementById("sum").innerHTML = sub_total*(100-promotion)/100 * 0.9;	
}
function payFunc() {
	document.getElementById("my_modal_value").innerHTML = "Total: "+ sub_total*(100-promotion)/100 * 0.9;
	console.log(document.getElementById("my_modal_value").value);
	// $("#myModal").find('.p').val('xxx');
	$("#myModal").modal("show");	
	// window.alert("Total: "+ sub_total*(100-promotion)/100 * 0.9);
	myTable = document.getElementById("salesTable");
	var rowCount = myTable.rows.length; while(--rowCount) myTable.deleteRow(rowCount);
	document.getElementById("sub_total").innerHTML = 0;
	document.getElementById("tax").innerHTML = 0;
	document.getElementById("sum").innerHTML = 0;
	document.getElementById("promotion").innerHTML = 0;

}
var del = document.getElementById('pay_btn')

del.addEventListener('click', function () {
  fetch('employee', {
    method: 'delete',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      'name': 'Darth Vader'
    })
  })
  .then(res => {
    if (res.ok) return res.json()
  }).
  then(data => {
    console.log("hello"+data)
    window.location.reload()
  })
})
 </script>

<script type="text/javascript" src="/js/employee.js"></script>
<script type="text/javascript" src="/js/scanner.js"></script>
</body>

